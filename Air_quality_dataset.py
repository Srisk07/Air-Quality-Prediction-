# -*- coding: utf-8 -*-
"""Untitled94.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1K-BU4P7-MhPPiWsc1DdyvmkFu2uglQiI
"""

#Gradio
!pip install gradio

#uploading Zip file
from google.colab import files
uploaded = files.upload()

import zipfile
import os

# replace with your zip file name
zip_file = "air-quality-data-in-india.zip"

# unzip into a folder
with zipfile.ZipFile(zip_file, 'r') as zip_ref:
    zip_ref.extractall("air_quality_data")

# check extracted files
os.listdir("air_quality_data")

import pandas as pd
df = pd.read_csv("air_quality_data/city_day.csv")
df.head()

df = df[['City', 'PM2.5', 'PM10', 'NO2', 'CO', 'SO2', 'O3', 'AQI_Bucket']]
df.dropna(inplace=True)
df.head()

#From zip file getting seperated main dataset
import pandas as pd
df = pd.read_csv("air_quality_data/city_day.csv")
df.head()

#Exploratory Data analysis
#Check columns and remove unwanted / missing rowsdf.info()
df.isnull().sum().sort_values(ascending=False).head(5)

df = df[['City', 'PM2.5', 'PM10', 'NO2', 'CO', 'SO2', 'O3', 'AQI_Bucket']]
df.dropna(inplace=True)
df.head()

# Encode target label
from sklearn.preprocessing import LabelEncoder

le = LabelEncoder()
df['AQI_Bucket'] = le.fit_transform(df['AQI_Bucket'])
df.head()

#Split features & target
X = df[['PM2.5', 'PM10', 'NO2', 'CO', 'SO2', 'O3']]
y = df['AQI_Bucket']

from sklearn.model_selection import train_test_split
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report

rf_classifier = RandomForestClassifier(n_estimators=100, random_state=42)
rf_classifier.fit(X_train, y_train)

y_pred = rf_classifier.predict(X_test)

print("Accuracy:", accuracy_score(y_test, y_pred))
print("\nClassification Report:\n", classification_report(y_test, y_pred))

#Data Visualization
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix

sns.heatmap(confusion_matrix(y_test, y_pred), annot=True, fmt='d')
plt.title("Confusion Matrix")
plt.show()

#streamlit connection
import joblib

joblib.dump(rf_classifier, "rf_aqi_classifier.joblib")
joblib.dump(le, "label_encoder.joblib")

print(" Model & label encoder saved successfully!")

import gradio as gr
import numpy as np
import joblib

model = joblib.load("rf_aqi_classifier.joblib")
le = joblib.load("label_encoder.joblib")

def predict_air_quality(pm25, pm10, no2, co, so2, o3):
    X = np.array([[pm25, pm10, no2, co, so2, o3]])
    pred = model.predict(X)
    category = le.inverse_transform(pred)[0]
    return f"Predicted AQI Category: {category}"

iface = gr.Interface(
    fn=predict_air_quality,
    inputs=["number", "number", "number", "number", "number", "number"],
    outputs="text",
    title="ðŸŒ¿ Air Quality Prediction",
    description="Enter pollutant levels to predict the AQI category."
)

iface.launch()